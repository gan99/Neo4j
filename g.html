WITH ranked AS (
  SELECT
    d.*,
    ROW_NUMBER() OVER (
      PARTITION BY d.party_name
      ORDER BY COALESCE(d.updated_at, TIMESTAMP'1900-01-01 00:00:00') DESC,
               COALESCE(d.is_bmo_client, FALSE) DESC,
               d.party_id ASC
    ) AS rn
  FROM your_dataset d
)
SELECT *
FROM ranked
WHERE rn = 1;
